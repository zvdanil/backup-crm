# –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å –æ—Ç—á–µ—Ç —Ü–µ–ª–∏–∫–æ–º

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞

–í—ã –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å** –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞.

–°–∫—Ä–∏–ø—Ç `cleanup_orphaned_data_report.sql` —Å–æ–¥–µ—Ä–∂–∏—Ç **–±–æ–ª–µ–µ 14 –ø—Ä–æ–≤–µ—Ä–æ–∫**, –∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Ü–µ–ª–∏–∫–æ–º**.

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í DBeaver:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç)
   - –ù–∞–∂–º–∏—Ç–µ **Ctrl+`** –∏–ª–∏ **Ctrl+Enter**

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª** `cleanup_orphaned_data_report.sql`
   - –ù–∞–∂–º–∏—Ç–µ **Ctrl+O**
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
   - –ù–∞–∂–º–∏—Ç–µ **"Open"**

3. **–í—ã–¥–µ–ª–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å–∫—Ä–∏–ø—Ç–∞:**
   - –ù–∞–∂–º–∏—Ç–µ **Ctrl+A** (–≤—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ)

4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç:**
   - –ù–∞–∂–º–∏—Ç–µ **F5** (Execute SQL Script)
   - –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Execute SQL Script"** –Ω–∞ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

5. **–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –í –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è **–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫** —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
   - –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## üìä –ß—Ç–æ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:

```
| issue_type                                    | orphaned_count |
| --------------------------------------------- | -------------- |
| attendance (orphaned enrollments)             | 0              |
| attendance (orphaned group_lessons)          | 0              |
| enrollments (orphaned students)              | 0              |
| enrollments (orphaned activities)            | 0              |
| finance_transactions (orphaned students)      | 0              |
| finance_transactions (orphaned activities)   | 0              |
| finance_transactions (orphaned staff)        | 0              |
| staff_journal_entries (orphaned staff)       | 0              |
| staff_journal_entries (orphaned activities)  | 0              |
| staff_journal_entries (orphaned group_lessons)| 0              |
| staff_billing_rules (orphaned staff)         | 0              |
| staff_billing_rules (orphaned activities)    | 0              |
| staff_billing_rules (orphaned group_lessons) | 0              |
| group_lesson_sessions (orphaned group_lessons)| 0              |
| group_lessons (orphaned activities)          | 0              |
| group_lesson_staff (orphaned group_lessons)  | 0              |
| group_lesson_staff (orphaned staff)          | 0              |
| activity_teacher_history (orphaned activities)| 0              |
| activity_teacher_history (orphaned staff)    | 0              |
| activity_price_history (orphaned activities) | 0              |
| staff_payouts (orphaned staff)               | 0              |
| enrollments (orphaned teacher_id)            | 0              |
```

## üéØ –ï—Å–ª–∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã = 0

–ï—Å–ª–∏ **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `orphaned_count = 0`, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- ‚úÖ –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö **–Ω–µ—Ç "–º—É—Å–æ—Ä–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π**
- ‚úÖ –í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**

## ‚ö†Ô∏è –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–ï—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ —Å—Ç—Ä–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–∏—Å–ª–æ –±–æ–ª—å—à–µ 0, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```
| attendance (orphaned enrollments) | 15 |
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å—Ç—å 15 –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏, –∏ –∏—Ö –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:
1. –ó–∞–ø–∏—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ "–º—É—Å–æ—Ä–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ `cleanup_orphaned_data.sql`

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±

–ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Å—Ä–∞–∑—É:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å —Ç–µ–∫—Å—Ç** –∏–∑ —Ñ–∞–π–ª–∞ `cleanup_orphaned_data_report.sql`
2. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor (Ctrl+V)
3. –í—ã–¥–µ–ª–∏—Ç–µ –≤—Å–µ (Ctrl+A)
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ (F5)

## üí° –í–∞–∂–Ω–æ

- –í—ã–ø–æ–ª–Ω—è–π—Ç–µ **–≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Ü–µ–ª–∏–∫–æ–º**, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ **–≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π
- –ï—Å–ª–∏ –≤—Å–µ –Ω—É–ª–∏ - –æ—á–∏—Å—Ç–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É
