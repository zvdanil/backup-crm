-- ============================================
-- SQL скрипт для создания бэкапа данных
-- ============================================
-- Этот скрипт можно выполнить в Supabase SQL Editor
-- для экспорта структуры и данных таблиц
-- 
-- ВНИМАНИЕ: Это не полный бэкап, но поможет сохранить данные
-- Для полного бэкапа используйте pg_dump или Supabase CLI

-- ============================================
-- 1. Экспорт структуры таблиц
-- ============================================

-- Создайте файл со структурой всех таблиц:
-- Выполните в psql или через Supabase CLI:
-- pg_dump -h [host] -U [user] -d [database] --schema-only > schema_backup.sql

-- ============================================
-- 2. Экспорт данных (пример для основных таблиц)
-- ============================================

-- Можно использовать COPY команды для экспорта данных
-- Но проще использовать Supabase CLI или pg_dump

-- ============================================
-- 3. Список всех таблиц для проверки
-- ============================================

SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- ============================================
-- 4. Экспорт данных через COPY (для больших таблиц)
-- ============================================

-- Пример для таблицы students:
-- COPY (SELECT * FROM public.students) TO STDOUT WITH CSV HEADER;

-- ============================================
-- Рекомендация
-- ============================================
-- Для полного бэкапа лучше использовать:
-- 1. Supabase CLI: npx supabase db dump --db-url [connection_string] --file backup.sql
-- 2. pg_dump: pg_dump -h [host] -U [user] -d [database] -f backup.sql
-- 3. Или выполните скрипт create_backup_interactive.ps1
