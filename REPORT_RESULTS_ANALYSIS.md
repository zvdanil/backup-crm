# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç—á–µ—Ç–∞

## üìä –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
| issue_type                        | orphaned_count |
| --------------------------------- | -------------- |
| enrollments (orphaned teacher_id) | 0              |
```

## ‚úÖ –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏!

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ:
- **–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π** —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ `teacher_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `enrollments`
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

–°–∫—Ä–∏–ø—Ç `cleanup_orphaned_data_report.sql` —Å–æ–¥–µ—Ä–∂–∏—Ç **–º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫** (–±–æ–ª–µ–µ 10 —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π). 

–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å** –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞, –∞ –Ω–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Ü–µ–ª–∏–∫–æ–º.

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç

1. –í SQL Editor —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç **–≤–µ—Å—å —Ñ–∞–π–ª** `cleanup_orphaned_data_report.sql`
2. –í—ã–¥–µ–ª–∏—Ç–µ **–≤–µ—Å—å —Ç–µ–∫—Å—Ç** (Ctrl+A)
3. –ù–∞–∂–º–∏—Ç–µ **F5** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ **–≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –≤ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ –æ–¥–Ω–æ–º—É

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π SELECT –∑–∞–ø—Ä–æ—Å –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

1. **Attendance —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ enrollments:**
```sql
SELECT 
    'attendance (orphaned enrollments)' as issue_type,
    COUNT(*) as orphaned_count
FROM public.attendance
WHERE enrollment_id NOT IN (SELECT id FROM public.enrollments);
```

2. **Enrollments —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ students:**
```sql
SELECT 
    'enrollments (orphaned students)' as issue_type,
    COUNT(*) as orphaned_count
FROM public.enrollments
WHERE student_id NOT IN (SELECT id FROM public.students);
```

3. **Finance transactions —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏:**
```sql
SELECT 
    'finance_transactions (orphaned students)' as issue_type,
    COUNT(*) as orphaned_count
FROM public.finance_transactions
WHERE student_id IS NOT NULL 
  AND student_id NOT IN (SELECT id FROM public.students);
```

–ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

## üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫:

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. ‚úÖ Attendance —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ enrollments
2. ‚úÖ Attendance —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ group_lessons
3. ‚úÖ Enrollments —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ students
4. ‚úÖ Enrollments —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ activities
5. ‚úÖ Finance transactions —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏
6. ‚úÖ Staff journal entries —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏
7. ‚úÖ Staff billing rules —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏
8. ‚úÖ Group lesson sessions —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ group_lessons
9. ‚úÖ Group lessons —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ activities
10. ‚úÖ Group lesson staff —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏
11. ‚úÖ Activity teacher history —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑—è–º–∏
12. ‚úÖ Activity price history —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ activities
13. ‚úÖ Staff payouts —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
14. ‚úÖ Enrollments —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ teacher_id (—ç—Ç–æ –≤—ã —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ - 0)

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Ü–µ–ª–∏–∫–æ–º** - –≤—ã–¥–µ–ª–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç (Ctrl+A) –∏ –Ω–∞–∂–º–∏—Ç–µ F5
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
3. **–ï—Å–ª–∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 0** - –∑–Ω–∞—á–∏—Ç "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –∏ –æ—á–∏—Å—Ç–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
4. **–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ `cleanup_orphaned_data.sql`

## ‚úÖ –ï—Å–ª–∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã = 0:

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç "–º—É—Å–æ—Ä–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π. –û—á–∏—Å—Ç–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

–≠—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ò–ª–∏ "–º—É—Å–æ—Ä–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ —É–∂–µ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã —Ä–∞–Ω–µ–µ

## üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç –æ—Ç—á–µ—Ç–∞** (Ctrl+A, F5)
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
3. **–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É
4. **–ï—Å–ª–∏ –≤—Å–µ –Ω—É–ª–∏** - –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –±–∞–∑–∞ –≤ –ø–æ—Ä—è–¥–∫–µ!
