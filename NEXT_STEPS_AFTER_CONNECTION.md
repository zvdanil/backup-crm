# –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**–ü–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –ë–î –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø!**

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ DBeaver (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫** –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –±–∞–∑–µ `postgres`
2. –í—ã–±–µ—Ä–∏—Ç–µ **"Tools"** ‚Üí **"Backup Database"** –∏–ª–∏ **"Export Data"**
3. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **Format:** SQL –∏–ª–∏ CSV
   - **Tables:** –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ
   - **Output file:** –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: `C:\Users\User\Downloads\crmbackup-cursor\backup_manual.sql`
4. –ù–∞–∂–º–∏—Ç–µ **"Start"** –∏–ª–∏ **"Export"**
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ SQL —Å–∫—Ä–∏–ø—Ç

1. –í DBeaver –æ—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** (Ctrl+`)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Ñ–∞–π–ª–∞ `export_tables.sql` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üßπ –®–∞–≥ 2: –û—á–∏—Å—Ç–∫–∞ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö

**–í–ê–ñ–ù–û:** –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞!

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ SQL —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `cleanup_orphaned_data_report.sql` –≤ DBeaver
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç - –æ–Ω –ø–æ–∫–∞–∂–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `cleanup_orphaned_data.sql`
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é (–ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏)

–ï—Å–ª–∏ –≤—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é `20260209000000_add_cleanup_orphaned_data_function.sql`:

1. –í SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```sql
   SELECT * FROM public.cleanup_orphaned_data();
   ```
2. –§—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç –æ—Ç—á–µ—Ç –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (5 –º–∏–Ω—É—Ç)

1. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
2. ‚è≥ –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø —á–µ—Ä–µ–∑ DBeaver
3. ‚è≥ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ

### –≠—Ç–∞–ø 2: –ê–Ω–∞–ª–∏–∑ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö (2 –º–∏–Ω—É—Ç—ã)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `cleanup_orphaned_data_report.sql` –≤ DBeaver
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç (F5 –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "Execute")
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã - —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ü–∏—Ñ—Ä—ã —Ä–∞–∑—É–º–Ω—ã–µ

### –≠—Ç–∞–ø 3: –û—á–∏—Å—Ç–∫–∞ (1 –º–∏–Ω—É—Ç–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `cleanup_orphaned_data.sql` –≤ DBeaver
2. **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –≠—Ç–∞–ø 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ (5 –º–∏–Ω—É—Ç)

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "–º—É—Å–æ—Ä–Ω—ã–µ" –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–ª–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å
4. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞

---

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –≤ DBeaver:

1. **–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫** –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `postgres`
2. –í—ã–±–µ—Ä–∏—Ç–µ **"Tools"** ‚Üí **"Dump Database"** –∏–ª–∏ **"Export Data"**
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ:
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –Ω—É–∂–Ω—ã–µ
   - –§–æ—Ä–º–∞—Ç: **SQL** (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞) –∏–ª–∏ **CSV** (–¥–ª—è –¥–∞–Ω–Ω—ã—Ö)
   - –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É: `backup_manual_YYYYMMDD.sql`
4. –ù–∞–∂–º–∏—Ç–µ **"Start"**
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Å–∫—Ä–∏–ø—Ç–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ DBeaver (Ctrl+` –∏–ª–∏ View ‚Üí SQL Editor)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞ (File ‚Üí Open File)
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `cleanup_orphaned_data_report.sql`)
4. –ù–∞–∂–º–∏—Ç–µ **F5** –∏–ª–∏ –∫–Ω–æ–ø–∫—É **"Execute SQL Script"**
5. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π!**
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç—á–µ—Ç–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ—á–∏—Å—Ç–∫–∏
3. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –±—ç–∫–∞–ø—ã** –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ

---

## üìÅ –§–∞–π–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

- `cleanup_orphaned_data_report.sql` - –æ—Ç—á–µ—Ç –æ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö
- `cleanup_orphaned_data.sql` - —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
- `export_tables.sql` - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- `supabase/migrations/20260209000000_add_cleanup_orphaned_data_function.sql` - —Ñ—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫

1. ‚úÖ **–°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø** (—á–µ—Ä–µ–∑ DBeaver)
2. üìä **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—á–µ—Ç** (`cleanup_orphaned_data_report.sql`)
3. üßπ **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ—á–∏—Å—Ç–∫—É** (`cleanup_orphaned_data.sql`)
4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?
