# –ü–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –≤—Å–µ –µ—â–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, –µ—Å–ª–∏ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç?

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç **0 "–º—É—Å–æ—Ä–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π** - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- –í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

## ü§î –ù–æ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ –µ—â–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è?

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è, –ø—Ä–∏—á–∏–Ω–∞ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ **–ª–æ–≥–∏–∫–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–¥–µ**, –∞ –Ω–µ –≤ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–Ø –Ω–∞—à–µ–ª –≤ –∫–æ–¥–µ –ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏**, –µ—Å–ª–∏ —É –Ω–∏—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏:

**–í `AttendanceGrid.tsx` (—Å—Ç—Ä–æ–∫–∞ 59):**
```typescript
const visibleEnrollments = useMemo(() => (
  enrollments.filter(enrollment => 
    enrollment.is_active || enrollmentsWithCharges.has(enrollment.id)
  )
), [enrollments, enrollmentsWithCharges]);
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **–∞–∫—Ç–∏–≤–Ω—ã–µ** –∑–∞–ø–∏—Å–∏ (`is_active = true`)
- –ò **–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ** –∑–∞–ø–∏—Å–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (`enrollmentsWithCharges`)

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

–ö–æ–¥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏:
- –£ –Ω–∏—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º (`charged_amount > 0`)
- –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π:

```sql
-- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (enrollments)
SELECT 
    e.id,
    e.student_id,
    e.activity_id,
    e.is_active,
    e.unenrolled_at,
    s.full_name as student_name,
    a.name as activity_name
FROM public.enrollments e
LEFT JOIN public.students s ON s.id = e.student_id
LEFT JOIN public.activities a ON a.id = e.activity_id
WHERE e.is_active = false
ORDER BY e.unenrolled_at DESC;
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é:

```sql
-- –ó–∞–ø–∏—Å–∏ —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é, –Ω–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
SELECT 
    e.id,
    e.is_active,
    COUNT(a.id) as attendance_count,
    s.full_name as student_name,
    act.name as activity_name
FROM public.enrollments e
LEFT JOIN public.students s ON s.id = e.student_id
LEFT JOIN public.activities act ON act.id = e.activity_id
LEFT JOIN public.attendance a ON a.enrollment_id = e.id
WHERE e.is_active = false
GROUP BY e.id, e.is_active, s.full_name, act.name
HAVING COUNT(a.id) > 0
ORDER BY attendance_count DESC;
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:

```sql
-- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã
SELECT 
    id,
    full_name,
    status,
    created_at
FROM public.students
WHERE status != 'active' OR status IS NULL;
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π:

```sql
-- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
SELECT 
    id,
    name,
    is_active,
    created_at
FROM public.activities
WHERE is_active = false;
```

---

## üí° –†–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–¥–µ

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–∫—Ä—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é:

**–í `AttendanceGrid.tsx`:**
```typescript
// –ë—ã–ª–æ:
const visibleEnrollments = useMemo(() => (
  enrollments.filter(enrollment => 
    enrollment.is_active || enrollmentsWithCharges.has(enrollment.id)
  )
), [enrollments, enrollmentsWithCharges]);

// –°—Ç–∞–Ω–µ—Ç (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ):
const visibleEnrollments = useMemo(() => (
  enrollments.filter(enrollment => enrollment.is_active)
), [enrollments]);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é

–ï—Å–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã:

```sql
-- –£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
DELETE FROM public.enrollments
WHERE is_active = false
  AND id NOT IN (
    SELECT DISTINCT enrollment_id 
    FROM public.attendance 
    WHERE enrollment_id IS NOT NULL
  );
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ

–í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è, –º–æ–∂–Ω–æ –ø–æ–º–µ—Ç–∏—Ç—å:

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
UPDATE public.enrollments
SET is_active = false, unenrolled_at = CURRENT_TIMESTAMP
WHERE is_active = true 
  AND student_id IN (
    SELECT id FROM public.students WHERE status != 'active'
  );
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
2. **–†–µ—à–∏—Ç–µ, —á—Ç–æ –¥–µ–ª–∞—Ç—å:**
   - –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å –∏—Å—Ç–æ—Ä–∏–µ–π - –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Ö –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ —Å–∫—Ä—ã—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
   - –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∞—Ä—Ö–∏–≤–Ω—ã–µ
3. **–ò–∑–º–µ–Ω–∏—Ç–µ –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è** –∏–ª–∏ **—É–¥–∞–ª–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π

---

## üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å?

1. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –≤—ã—à–µ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
2. **–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - —è –ø–æ–º–æ–≥—É —Ä–µ—à–∏—Ç—å, —á—Ç–æ —Å –Ω–∏–º–∏ –¥–µ–ª–∞—Ç—å
3. **–ò–ª–∏ –æ–ø–∏—à–∏—Ç–µ, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –¥–∞–Ω–Ω—ã–µ** –≤—ã –≤–∏–¥–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ç–∞–º –±—ã—Ç—å
